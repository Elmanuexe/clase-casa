CREATE TABLE EJ_PP_USUARIOS(
	DNI			    	VARCHAR2(10),
	NOMBRE		    	VARCHAR2(50),
	APELLIDOS			VARCHAR2(250),
	DIRECCION			VARCHAR2(75),
	MOVIL				VARCHAR(12),
	E_MAIL	    		VARCHAR2(100),
	PASS    			VARCHAR2(4),
	SALDO_DISPONIBLE	NUMBER(5,3) DEFAULT 0,
	FECHA_BAJA 		DATE,

    CONSTRAINT PK_EJ_PP_USUARIOS PRIMARY KEY (DNI),
    CONSTRAINT NN_EJ_PP_NOMBRE CHECK (NOMBRE IS NOT NULL),
    CONSTRAINT NN_EJ_PP_APELLIDOS CHECK (APELLIDOS IS NOT NULL),
    CONSTRAINT NN_EJ_PP_E_MAIL CHECK (E_MAIL IS NOT NULL),
    CONSTRAINT NN_EJ_PP_PASS CHECK (PASS IS NOT NULL),
    CONSTRAINT NN_EJ_PP_SALDO CHECK (SALDO_DISPONIBLE IS NOT NULL),
    CONSTRAINT CK_EJ_PP_PASS2 CHECK (PASS NOT LIKE '% %')
);




CREATE TABLE EJ_PP_ESTACIONES(
	COD_ESTACION		VARCHAR2(10),
	NUM_ESTACION		NUMBER(10),
	DIRECCION			VARCHAR2(50),
	LATITUD			    NUMBER(13,10),
	LONGITUD			NUMBER(13,10),

	CONSTRAINT PK_EJ_PP_ESTACIONES PRIMARY KEY (COD_ESTACION);
	CONSTRAINT CK_EJ_PP_ESTACIONES_COD CHECK (UPPER(COD_ESTACION) LIKE 'E%'));
	CONSTRAINT NN_EJ_PP_ESTACIONES_NUM_EST CHECK (NUM_ESTACION IS NOT NULL);
	CONSTRAINT NN_EJ_PP_ESTACIONES_DIR CHECK (DIRECCION IS NOT NULL);
	CONSTRAINT NN_EJ_PP_ESTACIONES_LAT CHECK (LATITUD IS NOT NULL);
    CONSTRAINT NN_EJ_PP_ESTACIONES_LONG CHECK (LONGITUD IS NOT NULL);
);
	


CREATE TABLE EJ_PP_BICICLETAS(
	COD_BICICLETA		NUMBER(10),
	MARCA		    	VARCHAR2(20),
	MODELO			    VARCHAR2(20),
	FECHA_ALTA			DATE,

CONSTRAINT PK_EJ_PP_BICICLETAS PRIMARY KEY (COD_BICICLETA),
CONSTRAINT NN_EJ_PP_MAR CHECK (MARCA IS NOT NULL),
CONSTRAINT NN_EJ_PP_MOD CHECK (MODELO IS NOT NULL),
CONSTRAINT NN_EJ_PP_FEC CHECK (FECHA_ALTA IS NOT NULL)
);


CREATE TABLE EJ_PP_USO(
	ESTACION_SALIDA		VARCHAR2(10),
	FECHA_SALIDA		DATE,
	DNI_USUARIO		    VARCHAR2(10),
	COD_BICICLETA		NUMBER(10),
	ESTACION_LLEGADA	VARCHAR2(10),
	FECHA_LLEGADA		DATE,

	CONSTRAINT PK_EJ_PP_USO PRIMARY KEY (ESTACION_SALIDA, FECHA_SALIDA, DNI_USUARIO, COD_BICICLETA, ESTACION_LLEGADA, FECHA_LLEGADA),
	CONSTRAINT NN_EJ_PP_USO_FECHA_SAL CHECK (FECHA_SALIDA IS NOT NULL),
	CONSTRAINT NN_EJ_PP_USO_DNI_USU CHECK (DNI_USUARIO IS NOT NULL),
	CONSTRAINT NN_EJ_PP_USO_FECHA_LLE CHECK (FECHA_LLEGADA IS NOT NULL),
);


CREATE SYNONYM TRIUSUAR FOR EJ_PP_USUARIOS;
CREATE SYNONYM TRIBICICLE FOR EJ_PP_BICICLETAS;
CREATE SYNONYM TRIESTAC FOR EJ_PP_ESTACIONES;
CREATE SYNONYM TRIUSO FOR EJ_PP_USO;


CREATE SEQUENCE SEQ_COD_BIC
START WITH 1
INCREMENT BY 1;

CREATE SEQUENCE SEQ_NUM_ESTA
START WITH 1
INCREMENT BY 1;


INSERT INTO TRIESTAC 
VALUES ('E123454', SEQ_NUM_ESTA.NEXTVAL, 'Calle real de la Jara','14.23424','32.56646');

INSERT INTO TRIESTAC 
VALUES ('E123455', SEQ_NUM_ESTA.NEXTVAL, 'Calle Ancha','12.5464','-32.56646');

INSERT INTO TRIESTAC 
VALUES ('E123456', SEQ_NUM_ESTA.NEXTVAL, 'San Martín de Porres','-11.23424','32.56646');

INSERT INTO TRIESTAC 
VALUES ('E123457', SEQ_NUM_ESTA.NEXTVAL, 'Parque de los Principes','-45.23424','-12.56646');

INSERT INTO TRIESTAC 
VALUES ('E123457', SEQ_NUM_ESTA.NEXTVAL, 'San Jacinto','-45.23424','-12.56646');

INSERT INTO TRIESTAC 
VALUES ('E123458', SEQ_NUM_ESTA.NEXTVAL, 'Calle Betis','12.523424','34.56646');

INSERT INTO TRIESTAC 
VALUES ('E123459', SEQ_NUM_ESTA.NEXTVAL, 'San Vicente de Paul','25.23424','-19.5646');

INSERT INTO TRISETAC
VALUES ('E201000003', SEQ_NUM_ESTA.NEXTVAL, 'López de Gomara', '37.7880814', '- 5.9985352');


INSERT INTO TRIUSUAR 
VALUES ('6487287X', 'Manuel', 'Martinez Montañés', 'Juan Díaz de Solís 27 3º a', 6325145895, 'ASDFASASD', '150', TO_DATE('12/02/2020',('DD/MM/YYYY')); 

INSERT INTO TRIUSUAR 
VALUES ('6485287X', 'Manuel', 'Fernández Civera', 'Lopez de Gomara 27 3º a', 6532145897, 'uqhwj', '123456', '1500', TO_DATE('12/02/2020',('DD/MM/YYYY'));

INSERT INTO TRIUSUAR 
VALUES ('8773484Y', 'Carlos', 'Díaz Lopera', 'Lopez de Gomara 27 3º a', 652453658, 'prqeurb', '123456', '150', TO_DATE('12/02/2020',('DD/MM/YYYY')); 

INSERT INTO TRIUSUAR 
VALUES ('9751478K', 'Manuel', 'Martinez Montañés', 'Juan Díaz de Solís 27 3º a' 653248596, 'XHGFTHDTDYSX', 'JAJASI', TO_DATE('12/02/2020',('DD/MM/YYYY'));  


INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'SPECIALIZED', 'MONTAÑA', TO_DATE('12/02/2020','DD/MM/YYYY'));

INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'SCOTT', MONTAÑA, TO_DATE('13/02/2020','DD/MM/YYYY'));

INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'TREK', CALLE,  TO_DATE('14/02/2020','DD/MM/YYYY'));

INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'SPECIALIZED', MOUNTAINBIKE, TO_DATE('15/02/2020','DD/MM/YYYY'));

INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'SCOTT', MOUNTAINBIKE, TO_DATE('16/02/2020','DD/MM/YYYY'));

INSERT INTO TRIBICICLE
VALUES (SEQ_COD_BIC.NETXVAL, 'TREK', MONTAÑA, TO_DATE('17/02/2020','DD/MM/YYYY'));


INSERT INTO TRIUSO
VALUES ('1', SYSDATE, '8773484Y', '1', '2', SYSDATE);

INSERT INTO TRIUSO
VALUES ('2', SYSDATE, '8773484Y', '5', '3', SYSDATE);

INSERT INTO TRIUSO
VALUES ('3', SYSDATE, '8773484Y', '6', '1', SYSDATE);

INSERT INTO TRIUSO
VALUES ('3', SYSDATE, '8773484Y', '2', '2', SYSDATE);

INSERT INTO TRIUSO
VALUES ('5', TO_DATE('11/02/2020 13:35',('DD/MM/YYYY HH24:MI'), '8773484Y', '1', '4', TO_DATE('11/02/2020 13:43',('DD/MM/YYYY HH24:MI'));

INSERT INTO TRIUSO
VALUES ('6', TO_DATE('11/02/2020 12:0',('DD/MM/YYYY HH24:MI'), '9751478K', '3', '5', TO_DATE('11/02/2020 12:15',('DD/MM/YYYY HH24:MI'));

INSERT INTO TRIUSO
VALUES ('4', TO_DATE('10/02/2020 9:12',('DD/MM/YYYY HH24:MI'), '8773484Y', '3', '5', TO_DATE('10/02/2020 09:21',('DD/MM/YYYY HH24:MI'));

INSERT INTO TRIUSO
VALUES ('7', TO_DATE('12/02/2020 08:45',('DD/MM/YYYY HH24:MI'), '9751478K', '3', '6', TO_DATE('12/02/2020 08:53',('DD/MM/YYYY HH24:MI'));




SELECT NOMBRE, ROUND(((FECHA_LLEGADA-FECHA_SALIDA)* 24 * 60),2)*0.001 AS DURACION FROM TRI_USO JOIN TRI_USUARIO ON (DNI_USUARIO = DNI);

